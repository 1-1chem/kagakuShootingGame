<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åŒ–å­¦å¼ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚²ãƒ¼ãƒ </title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      height: 100vh;
      background-color: #f0f0f0;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }
    .container {
      position: relative;
      width: 100%;
      height: 100%;
    }
    .text {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      font-size: 24px;
      font-weight: bold;
      color: #333;
    }
    
    .text-fall {
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);/*ã‚³ã‚³ã‚’100ã«ã™ã‚Œã°å…¨ç”»é¢*/
        font-size: 18px;
        font-weight: bold;
        color: #333;
        top: 10%;    }

    .text-rise {
        font-size: 48px; /* æ–‡å­—ã‚’å¤§ãã */
        font-weight: bold;
        color: #333;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        bottom: 10%; /* ğŸ”´ åˆæœŸä½ç½®ã‚’è¨­å®š */
        /* display: none; åˆæœŸçŠ¶æ…‹ã§ã¯éè¡¨ç¤º */
    }

    /* ä¸Šä»˜ãæ–‡å­— (sup) ã®ã‚µã‚¤ã‚ºã‚‚èª¿æ•´ */
    .text-rise sup {
        font-size: 36px; /* é€šå¸¸ã®åŠåˆ†ãã‚‰ã„ã®ã‚µã‚¤ã‚ºã« */
    }
    /* ä¸‹ä»˜ãæ–‡å­— (sub) ã®ã‚µã‚¤ã‚ºã‚‚èª¿æ•´ */
    .text-rise sub {
        font-size: 36px; /* é€šå¸¸ã®åŠåˆ†ãã‚‰ã„ã®ã‚µã‚¤ã‚ºã« */
    }

    .fragment {
        position: absolute;
        font-size: 24px;
        font-weight: bold;
        color: #333;
        opacity: 0;
        animation: scatter 1s forwards;
    }
    sup {
          font-size: 16px;
    }
    
    .timeout-message {
        font-size: 48px; /* æ–‡å­—ã‚’å¤§ãã */
        font-weight: bold;
        color: #fe0101;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        top: 15%; /*  åˆæœŸä½ç½®ã‚’è¨­å®š */
        display: none;
    }


    #startButton {
      position: absolute;
      top: 25%;
      left: 50%;
      padding: 10px;
      font-size: 40px;
      background-color: #5374e1;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 8px;

    }
    #inputContainer {
      position: absolute;
      top: 45%;
      left: 40%;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      display: none; /* æœ€åˆã¯éè¡¨ç¤º */
    }
    #inputText {
      width: 120px; /*  æœ€å°å¹…ã‚’è¨­å®š */
      font-size: 14px; /* æ–‡å­—ã‚µã‚¤ã‚ºã‚’é©åˆ‡ã« */
      padding: 4px 8px; /* å†…å´ã®ä½™ç™½ã‚’å°ã•ãã™ã‚‹ */
      margin-bottom: 10px;
    }
    
    #fireButton {
        position: absolute;
        bottom: 5%;
        left: 85%;
        padding: 10px 20px;
        font-size: 16px;
        width: 80px;
        background-color: #4CAF50;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 5px;
    }
    
    #nextButton {
        position: absolute;
        bottom: 5%;
        left: 85%;
        padding: 10px 20px;
        font-size: 16px;
        width: 80px;
        background-color: #5374e1;
        color: white;
        border: none;
        cursor: pointer;
    }
    #scoreDisplay {
        position: absolute;
        top: 5px;
        right: 5px;
        font-size: 14px;
        font-weight: bold;
        color: #333;
    }
    #timerDisplay {
        position: absolute;
        top: 20px;
        right: 5px;
        font-size: 14px;
        font-weight: bold;
        color: #d9534f; /* èµ¤è‰² */
    }

    #highScoreDisplay {
      position: absolute;
      top: 5px;
      left: 10px;
      font-size: 14px;
      font-weight: bold;
      color: blue;
    }


    .formatted-answer {
    
      font-size: 48px; /* æ–‡å­—ã‚’å¤§ãã */
        font-weight: bold;
        color: #333;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        bottom: 55%; /* ğŸ”´ åˆæœŸä½ç½®ã‚’è¨­å®šâ†ã‚³ã‚³ã‚’10ã«ã™ã‚‹ã¨å…¨ç”»é¢ */
          }

    .formatted-answer sup {
        font-size: 36px; /* é€šå¸¸ã®åŠåˆ†ãã‚‰ã„ã®ã‚µã‚¤ã‚ºã« */
    }
  #lifeContainer {
  position: absolute;
  top: 7%; 
  right: 5px;
  text-align: center;
}

#lifeLabel {
  font-size: 16px;
  font-weight: bold;
  color: black; /*  "Life" ã®è‰² */
  margin-bottom: 1px; /* "Life" ã¨ "â™¥â™¥â™¥" ã®é–“éš” */
}

#lifeDisplay {
  font-size: 18px;
  font-weight: bold;
  color: red; /*  ãƒãƒ¼ãƒˆã‚’èµ¤è‰² */
}



#gameOverMessage {
  display: none; /*  åˆæœŸçŠ¶æ…‹ã§ã¯éè¡¨ç¤º */
  position: absolute;
  top: 40%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 36px;
  font-weight: bold;
  color: red;
  text-align: center;
}

#finalScore {
  display: none;
  position: absolute;
  top: 50%; /* ã€Œã‚²ãƒ¼ãƒ çµ‚äº†ã€ã®ä¸‹ã«é…ç½® */
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 14px;
  font-weight: bold;
  color: black;
  text-align: center;
}
#restartButton {
  display: none; /* æœ€åˆã¯éè¡¨ç¤º */
  position: absolute;
  top: 20%;
  left: 50%;
  transform: translate(-50%, -50%);
  padding: 15px 30px;
  font-size: 20px;
  background-color: #FF5733; /* ã‚ªãƒ¬ãƒ³ã‚¸è‰² */
  color: white;
  border: none;
  cursor: pointer;
  border-radius: 8px;
}

    
    @keyframes rise {
      0% {bottom: 0;}
      100% {bottom: 100vh;}
    }

    @keyframes scatter {
      0% {opacity: 1;transform: translate(0, 0);
      }
      100% {opacity: 0;transform: translate(calc(var(--x) * 1px), calc(var(--y) * 1px));
      }
    }
 
  </style>

</head>
<body>
  
  <div class="container">
    <div id="highScoreDisplay">High Score: 0</div>
    <div id="scoreDisplay">ã‚¹ã‚³ã‚¢: 0</div>
    <button id="startButton">é–‹å§‹</button>
    <div class="text text-fall" id="fallingText">åŒ–å­¦å¼ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚²ãƒ¼ãƒ </div>
    <div id="timerDisplay">æ®‹æ™‚é–“: 20ç§’</div>
    <div id="timeout-message" class="timeout-message">æ™‚é–“åˆ‡ã‚Œï¼</div>
    <div class="text text-rise" id="risingText"><sup></sup></div>
    <div id="formatted-answer" class="formatted-answer"></div>
    <div id="lifeContainer">
      <div id="lifeLabel">Life</div>
      <div id="lifeDisplay">â™¥â™¥â™¥</div>
    </div>
    <div id="gameOverMessage">ã‚²ãƒ¼ãƒ çµ‚äº†</div>
    <div id="finalScore"></div> <!--  æœ€çµ‚ã‚¹ã‚³ã‚¢ã‚’è¡¨ç¤ºã™ã‚‹ã‚¨ãƒªã‚¢ -->
    <div id="inputContainer">
      <input type="text" id="inputText" placeholder="åŒ–å­¦å¼ã¯ï¼Ÿ">
      <button id="fireButton">ç™ºå°„</button>
      <button id="nextButton">æ¬¡ã¸</button>
    </div>
    <button id="restartButton">ã‚‚ã†ä¸€å›</button>  
  </div>

  <audio id="fireSound" src="fire-sound.mp3" preload="auto"></audio>
  <audio id="explosionSound" src="explosion-sound.mp3" preload="auto"></audio>
  <audio id="timeOverSound" src="bubu-.mp3" preload="auto"></audio>

<script>

//å®šæ•°ã®å®£è¨€
    const totalFallSteps = 200;//è½ä¸‹ã‚¹ãƒ†ãƒƒãƒ—æ•°
    const fallDuration = 20000;//è½ä¸‹æ™‚é–“
    const fallStepDuration = fallDuration / totalFallSteps;//è½ä¸‹ã‚¹ãƒ†ãƒƒãƒ—æ™‚é–“
    const timeoutMessage = document.getElementById("timeout-message");
    const fallingText = document.getElementById('fallingText');//è½ä¸‹æ–‡å­—
    const risingText = document.getElementById('risingText');// ä¸Šæ˜‡æ–‡å­—
    const fireButton = document.getElementById('fireButton');//ç™ºå°„ãƒœã‚¿ãƒ³
    const inputTextInput = document.getElementById('inputText'); //ã‚«ã‚¹ã‚¿ãƒ ãƒ†ã‚­ã‚¹ãƒˆ
    const fireSound = document.getElementById('fireSound');// ç™ºå°„éŸ³
    const nextButton = document.getElementById('nextButton');// æ¬¡ã®ãƒœã‚¿ãƒ³
    const explosionSound = document.getElementById('explosionSound');// çˆ†ç™ºéŸ³
    const timeOverSound = document.getElementById('timeOverSound');// æ™‚é–“åˆ‡ã‚ŒéŸ³
    const correctFormula = document.getElementById('correctFormula');//æ­£è§£
    const startButton = document.getElementById("startButton");
    const formattedAnswer = document.getElementById("formatted-answer");//ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚ŒãŸè§£ç­”
    const maxFallHeight = 31; // ğŸ”´ æœ€å¤§è½ä¸‹ç¯„å›²ã‚’ 31% ã«åˆ¶é™(ç™ºå°„æ–‡å­—ã¨è¢«ã‚‰ã›ãªã„ãŸã‚)
    const maxRiseHeight = -50; // ğŸ”´ æœ€å¤§ä¸Šæ˜‡ç¯„å›²ã‚’ -50% ã«åˆ¶é™ï¼ˆä¸Šæ–¹å‘ã«å‹•ãæ–‡å­—ãŒçªãæŠœã‘ã‚‹ï¼‰
    //ğŸ”´formattedAnswerã®ä½ç½®ã¯CSSã§
    //ğŸ”´risingText.style.bottom = "55%"; ã§ç™ºå°„æ–‡å­—ã®ä¸‹ç«¯ã‚’è¨­å®š

//ã‚¯ã‚¤ã‚ºãƒ‡ãƒ¼ã‚¿
    const quizData = [
      { name: "æ°´ç´ åŸå­", formula: "H" },
      { name: "æ°´ç´ åˆ†å­", formula: "H2_" },
      { name: "æ°´ç´ ã‚¤ã‚ªãƒ³", formula: "H+^" },
    ];

    let currentQuestionIndex = 0;//ç¾åœ¨ã®å•é¡Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
    let isFalling = true;//è½ä¸‹ä¸­ã‹ã©ã†ã‹
    let fallInterval;//è½ä¸‹é–“éš”
    let fallStep = 0;//è½ä¸‹ã‚¹ãƒ†ãƒƒãƒ—
    const container = document.querySelector('.container');//ã‚³ãƒ³ãƒ†ãƒŠ
    let scatterCount = 0;
    const maxScatterCount = 3;
    let risingAnimation;//ä¸Šæ˜‡ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    fireButton.style.display = "none"; //ç™ºå°„ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
    let score = 0; // ã‚¹ã‚³ã‚¢ã®åˆæœŸåŒ–
    let timeLeft = 20; // åˆ¶é™æ™‚é–“ï¼ˆç§’ï¼‰
    let timer; // ã‚¿ã‚¤ãƒãƒ¼å¤‰æ•°
    let timeOutCount = 0; // æ™‚é–“åˆ‡ã‚Œã®å›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
    let maxLives = 3; //  æœ€å¤§ãƒ©ã‚¤ãƒ•æ•°
    let highScore = 0; //  æœ€é«˜å¾—ç‚¹

    document.getElementById("restartButton").addEventListener("click", restartGame);
    //document.addEventListener("DOMContentLoaded", updateHighScoreDisplay);

//ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ  
document.addEventListener("DOMContentLoaded", () => {// htmlã‚„CSSã‚’èª­ã¿è¾¼ã‚“ã ã‚‰å®Ÿè¡Œ

  const fireButton = document.getElementById("fireButton");
    const fireSound = document.getElementById("fireSound");
    const explosionSound = document.getElementById("explosionSound");

  // ã‚¹ãƒãƒ›ã§éŸ³ãŒå‡ºã‚‹ã‚ˆã†ã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®ä¸­ã§å†ç”Ÿ
    fireButton.addEventListener("click", () => {
        fireSound.currentTime = 0; // éŸ³ã‚’ãƒªã‚»ãƒƒãƒˆ
        fireSound.play().catch(e => console.error("å†ç”Ÿã‚¨ãƒ©ãƒ¼:", e)); // ã‚¹ãƒãƒ›å¯¾å¿œ
    });

    startButton.addEventListener("click", () => {
        startButton.style.display = "none"; // é–‹å§‹ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
        fireButton.style.display = "block"; //ç™ºå°„ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
        loadQuestion();//å•é¡Œèª­ã¿è¾¼ã¿
    });
});

function restartGame() {
  score = 0; //  ã‚¹ã‚³ã‚¢ã‚’ãƒªã‚»ãƒƒãƒˆ
  timeOutCount = 0; //  ãƒ©ã‚¤ãƒ•ã‚’ãƒªã‚»ãƒƒãƒˆ
  currentQuestionIndex = 0; //  æœ€åˆã®å•é¡Œã«æˆ»ã‚‹

  //  ç”»é¢ã‚’ãƒªã‚»ãƒƒãƒˆ
  document.getElementById("gameOverMessage").style.display = "none";
  document.getElementById("finalScore").style.display = "none";
  document.getElementById("restartButton").style.display = "none";
  document.getElementById("fallingText").style.display = "block";
  document.getElementById("risingText").style.display = "block";
  document.getElementById("inputContainer").style.display = "flex";
  document.getElementById("nextButton").style.display = "block";
  document.getElementById("lifeContainer").style.display = "block";

  updateLifeDisplay(); // ãƒ©ã‚¤ãƒ•ã‚’æ›´æ–°
  updateHighScoreDisplay(); // æœ€é«˜å¾—ç‚¹ã‚’å†è¡¨ç¤º
  loadQuestion();//å•é¡Œèª­ã¿è¾¼ã¿
}
function updateHighScore() {
  if (score > highScore) { //æ–°ã—ã„ã‚¹ã‚³ã‚¢ãŒæœ€é«˜å¾—ç‚¹ãªã‚‰æ›´æ–°
    highScore = score;    
  }
}
function updateHighScoreDisplay() {
  document.getElementById("highScoreDisplay").textContent = `High Score: ${highScore}`;
}




//ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹é–¢æ•°  
function startTimer() {
    timeoutMessage.style.display = "none"; // ã€Œæ™‚é–“åˆ‡ã‚Œã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’éè¡¨ç¤º
    timeLeft = 20; // åˆ¶é™æ™‚é–“ãƒªã‚»ãƒƒãƒˆ
    document.getElementById("scoreDisplay").textContent = `ã‚¹ã‚³ã‚¢: ${score}`;
    document.getElementById("timerDisplay").textContent = `æ®‹æ™‚é–“: ${timeLeft}ç§’`; // åˆæœŸè¡¨ç¤º
    // æ¯ç§’ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³
    timer = setInterval(() => {
        timeLeft--;
        document.getElementById("timerDisplay").textContent = `æ®‹æ™‚é–“: ${timeLeft}ç§’`; // æ®‹ã‚Šæ™‚é–“ã‚’æ›´æ–°
        if (timeLeft <= 0) {
            clearInterval(timer);
            timeOverSound.play(); // æ™‚é–“åˆ‡ã‚ŒéŸ³ã‚’å†ç”Ÿ
            timeoutMessage.style.display = "block"; // ã€Œæ™‚é–“åˆ‡ã‚Œã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
            timeoutMessage.textContent = "æ™‚é–“åˆ‡ã‚Œï¼"; // ã€Œæ™‚é–“åˆ‡ã‚Œã€ã¨è¡¨ç¤º
            timeOutCount++; // æ™‚é–“åˆ‡ã‚Œã‚«ã‚¦ãƒ³ãƒˆã‚’å¢—ã‚„ã™
            nextButton.style.display = "block"; // ã€Œæ¬¡ã¸ã€ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
        }
    }, 1000);
}


//ã‚¯ã‚¤ã‚ºã®èª­ã¿è¾¼ã¿é–¢æ•°
function loadQuestion() {
  //å…¨ã¦ã®å•é¡Œã‚’çµ‚äº†ã—ãŸã‚‰çµ‚äº†ã‚’è¡¨ç¤º
    if (currentQuestionIndex >= quizData.length) {
    //  å…¨å•çµ‚äº†æ™‚ã«ã€Œã‚²ãƒ¼ãƒ çµ‚äº†ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
    updateLifeDisplay()
    endGame(); // ã‚²ãƒ¼ãƒ çµ‚äº†
    return; // ä»¥é™ã®å‡¦ç†ã‚’å®Ÿè¡Œã—ãªã„
    }
    if (timeOutCount >= maxLives) {
      updateLifeDisplay()  
      endGame(); // ã™ã§ã«ãƒ©ã‚¤ãƒ•ãŒã‚¼ãƒ­ãªã‚‰ã‚²ãƒ¼ãƒ çµ‚äº†
    return;
    }
    document.getElementById("inputContainer").style.display = "flex";
      const question = quizData[currentQuestionIndex];//å•é¡Œå–å¾—
      fallingText.textContent = question.name;//  è½ä¸‹æ–‡å­—ã«å•é¡Œåã‚’è¨­å®š
      fallingText.style.display = "block";//è½ä¸‹æ–‡å­—ã‚’è¡¨ç¤º
      nextButton.style.display = "none";//æ¬¡ã®ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
      fallStep = 0;
      isFalling = true;//è½ä¸‹ä¸­   
      risingText.style.display = 'block';//  ä¸Šæ˜‡æ–‡å­—ã‚’è¡¨ç¤º
      formattedAnswer.innerHTML  = ""; //  è§£ç­”ã‚’ãƒªã‚»ãƒƒãƒˆ
      risingText.innerHTML = ""; // ä¸Šæ˜‡æ–‡å­—ã‚’ãƒªã‚»ãƒƒãƒˆ
      inputTextInput.value = ""; // å…¥åŠ›æ¬„ã‚’ãƒªã‚»ãƒƒãƒˆ
      risingText.style.bottom = "55%"; // ğŸ”´ä½ç½®ã‚’ç”»é¢ä¸‹ç«¯ã«ãƒªã‚»ãƒƒãƒˆ
      inputTextInput.focus();// å…¥åŠ›æ¬„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
      // ã‚¿ã‚¤ãƒãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
      clearInterval(timer); // ã‚¿ã‚¤ãƒãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
        document.getElementById("scoreDisplay").textContent = `ã‚¹ã‚³ã‚¢: ${score}`;
    // `fragment` ã‚¯ãƒ©ã‚¹ã®ä¸è¦ãªæ–‡å­—ã‚’å‰Šé™¤ï¼ˆå‰å›ã®æ•£ä¹±ã‚’ãƒªã‚»ãƒƒãƒˆï¼‰
        document.querySelectorAll(".fragment").forEach((el) => el.remove());
      startTimer(); //ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
      updateLifeDisplay(); // ãƒ©ã‚¤ãƒ•ã‚’æ›´æ–°
      moveFallingText();//è½ä¸‹æ–‡å­—ç§»å‹•
    }
   

//æ–‡å­—ã‚’è½ä¸‹ã•ã›ã‚‹é–¢æ•°        
  function moveFallingText() {
      if (fallStep <= totalFallSteps && isFalling) {//è½ä¸‹ã‚¹ãƒ†ãƒƒãƒ—ãŒæœ€å¤§ã‚¹ãƒ†ãƒƒãƒ—ä»¥ä¸‹ã‹ã¤è½ä¸‹ä¸­ã®å ´åˆ
        const percentage = (fallStep / totalFallSteps) * maxFallHeight;//ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸è¨ˆç®—
        fallingText.style.top = `calc(${percentage}vh)`;//è½ä¸‹æ–‡å­—ã®ä½ç½®ã‚’è¨­å®š
        checkCollision();//è¡çªç¢ºèª
        // è½ä¸‹æ–‡å­—ãŒç”»é¢ä¸‹ç«¯ã«åˆ°é”ã—ãŸã‚‰ã€Œæ™‚é–“åˆ‡ã‚Œã€
        const fallingRect = fallingText.getBoundingClientRect();
        const windowHeight = window.innerHeight;
        if (fallingRect.bottom >= windowHeight) {
            isFalling = false; // è½ä¸‹ã‚’åœæ­¢
            clearInterval(timer); // ã‚¿ã‚¤ãƒãƒ¼åœæ­¢
            timeOutCount++; // æ™‚é–“åˆ‡ã‚Œã‚«ã‚¦ãƒ³ãƒˆã‚’å¢—ã‚„ã™
            updateLifeDisplay(); // ãƒ©ã‚¤ãƒ•ã‚’æ›´æ–°
      if (timeOutCount >= 3) {
        endGame(); // 3å›æ™‚é–“åˆ‡ã‚Œãªã‚‰ã‚²ãƒ¼ãƒ çµ‚äº†
        return;
      }
      nextButton.style.display = "block"; // ã€Œæ¬¡ã¸ã€ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
        } else {
            fallStep++;
            setTimeout(moveFallingText, fallStepDuration);
        }
      }
  }
  
//è¡çªæ¤œçŸ¥é–¢æ•°
    function checkCollision() {
      const fallingRect = fallingText.getBoundingClientRect();//  è½ä¸‹æ–‡å­—ã®çŸ©å½¢ã‚’å–å¾—
      const risingRect = risingText.getBoundingClientRect();//  ä¸Šæ˜‡æ–‡å­—ã®çŸ©å½¢ã‚’å–å¾—
      if (
        fallingRect.top >= risingRect.top &&// è½ä¸‹æ–‡å­—ã®ä¸Šç«¯ãŒä¸Šæ˜‡æ–‡å­—ã®ä¸Šç«¯ã‚ˆã‚Šå¤§ãã„ã‹
        //fallingRect.top <= risingRect.bottom &&// è½ä¸‹æ–‡å­—ã®ä¸Šç«¯ãŒä¸Šæ˜‡æ–‡å­—ã®ä¸‹ç«¯ã‚ˆã‚Šå°ã•ã„ã‹
        fallingRect.left <= risingRect.right &&// è½ä¸‹æ–‡å­—ã®å·¦ç«¯ãŒä¸Šæ˜‡æ–‡å­—ã®å³ç«¯ã‚ˆã‚Šå°ã•ã„ã‹
        fallingRect.right >= risingRect.left// è½ä¸‹æ–‡å­—ã®å³ç«¯ãŒä¸Šæ˜‡æ–‡å­—ã®å·¦ç«¯ã‚ˆã‚Šå¤§ãã„ã‹
      ) {
        inputTextInput.focus();// å…¥åŠ›æ¬„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
        checkAnswer(inputTextInput,fallingRect)
        inputTextInput.value = ""; // å…¥åŠ›æ¬„ã‚’ãƒªã‚»ãƒƒãƒˆ
        }
    }

//ã€€ç­”ãˆåˆã‚ã›é–¢æ•°
  function checkAnswer(inputText,fallingRect) {
      const correctAnswer = quizData[currentQuestionIndex].formula;//  æ­£è§£ã®å–å¾—
      const kaitou =inputText.value
      if (kaitou === correctAnswer) {//  å…¥åŠ›å€¤ãŒæ­£è§£ã®å ´åˆ
          clearInterval(timer); //ã€€ã‚¿ã‚¤ãƒãƒ¼åœæ­¢
          explosionSound.play();//çˆ†ç™ºéŸ³å†ç”Ÿ
          score += timeLeft; //  æ®‹ã‚Šæ™‚é–“ã‚’ã‚¹ã‚³ã‚¢ã«åŠ ç®—
          document.getElementById("scoreDisplay").textContent = `ã‚¹ã‚³ã‚¢: ${score}`;
          scatterText(fallingRect);//  æ•£ä¹±æ–‡å­—
      } else {
       
      }
  }

//ã€€æ–‡å­—ãƒãƒ©ãƒãƒ©é–¢æ•°
  function scatterText(collisionRect) {
    const text = fallingText.textContent;
    fallingText.style.display = 'none';
    isFalling = false;
        const fragmentCount = text.length;
        const centerX = collisionRect.left + collisionRect.width / 2;
        const centerY = collisionRect.top + collisionRect.height / 2;

        for (let i = 0; i < fragmentCount; i++) {
            const char = text[i];
            const span = document.createElement('span');
            span.textContent = char;
            span.className = 'fragment';
            span.style.setProperty('--x', Math.random() * 200 - 100);
            span.style.setProperty('--y', Math.random() * 200 - 100);
            span.style.left = `${centerX}px`;
            span.style.top = `${centerY}px`;
            container.appendChild(span);
        }
    risingText.style.display = 'block';//}, 1000);
    nextButton.style.display = "block";
}

//ä¸Šæ˜‡æ–‡å­—ã‚’æ›´æ–°    
    function updateRisingText() {//ä¸Šæ˜‡æ–‡å­—ã®æ›´æ–°
      const input = inputTextInput.value.trim();//  å…¥åŠ›å€¤
      let formattedText = '';// ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿ãƒ†ã‚­ã‚¹ãƒˆ
      risingText.style.display = "block"; // å¤‰æ›æ–‡å­—ã‚’è¡¨ç¤º 

      for (let i = 0; i < input.length; i++) {//  å…¥åŠ›æ–‡å­—æ•°åˆ†ç¹°ã‚Šè¿”ã—
        if (input[i] === '^' && i > 0) {//  æ–‡å­—ãŒ^ã‹ã¤ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒ0ã‚ˆã‚Šå¤§ãã„å ´åˆ
          formattedText =
            formattedText.slice(0, -1) +
            `<sup>${formattedText.slice(-1)}</sup>`;//  ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿ãƒ†ã‚­ã‚¹ãƒˆã‚’æ›´æ–°
          } else if (input[i] === "_" && i > 0) {// _ã®å‰ã®æ–‡å­—ã‚’ä¸‹ä»˜ãã«
            formattedText =
            formattedText.slice(0, -1) +
            `<sub>${formattedText.slice(-1)}</sub>`;//  ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿ãƒ†ã‚­ã‚¹ãƒˆã‚’æ›´æ–°
          } else {
          formattedText += input[i];
        }
      }
      risingText.style.display = 'block';//  ä¸Šæ˜‡æ–‡å­—ã‚’è¡¨ç¤º
      risingText.style.bottom = "55%"; // ğŸ”´å¿…è¦ã«å¿œã˜ã¦èª¿æ•´ â†ã‚³ã‚³ã‚’10ã«ã™ã‚‹ã¨å…¨ç”»é¢
      formattedAnswer.innerHTML  = formattedText|| '<sup></sup>';
      risingText.innerHTML = formattedText || '<sup></sup>';
      // ãƒ‡ãƒãƒƒã‚°ç”¨ã€€console.log("ã‚³ã‚³ã‚’é€šã‚Šã¾ã—ãŸï¼š ",risingText.innerHTML); 
    }

//ã€€æ–‡å­—ç™ºå°„é–¢æ•°  
    function fireinputText() {//ã‚«ã‚¹ã‚¿ãƒ ãƒ†ã‚­ã‚¹ãƒˆç™ºå°„
        fireSound.currentTime = 0; //  éŸ³ã‚’ãƒªã‚»ãƒƒãƒˆ
        fireSound.play().catch(e => console.error("å†ç”Ÿã‚¨ãƒ©ãƒ¼:", e)); //  ã‚¹ãƒãƒ›å¯¾å¿œ
    
        risingText.style.display = 'block';//  ä¸Šæ˜‡æ–‡å­—ã‚’è¡¨ç¤º
        const inputText = inputTextInput.value; // å…¥åŠ›å€¤ã‚’å–å¾—
        risingAnimation = risingText.animate(//  ä¸Šæ˜‡ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        [
          { transform: 'translateY(0) translateX(-50%)' },//  å¤‰æ›
          { transform: `translateY(${maxRiseHeight}vh) translateX(-50%)` } // ğŸ”´ ä¸Šæ˜‡ç¯„å›²ã‚’ -40vh ã«åˆ¶é™,ï¼100ã«ã™ã‚Œã°å…¨ç”»é¢
        ],
        {
          duration: 2000,//  æŒç¶šæ™‚é–“
          iterations: 1,//  ç¹°ã‚Šè¿”ã—å›æ•°
          fill: 'none' //  çµ‚ã‚ã£ãŸã‚‰å…ƒã®ä½ç½®ã«æˆ»ã‚‹
        }
      );
        risingAnimation.onfinish = () => {//  ä¸Šæ˜‡ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†æ™‚
      };
    }

// ãƒ©ã‚¤ãƒ•è¡¨ç¤ºã‚’æ›´æ–°
function updateLifeDisplay() {
  const lifeDisplay = document.getElementById("lifeDisplay");
  let lives = "â™¥".repeat(maxLives - timeOutCount); // æ®‹ã‚Šãƒ©ã‚¤ãƒ•ã‚’è¡¨ç¤º
  lifeDisplay.textContent = lives || "GAME OVER"; // 0ãªã‚‰ "GAME OVER" è¡¨ç¤º
}

// ã‚²ãƒ¼ãƒ çµ‚äº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
function endGame() {
    timeoutMessage.style.display = "none"; // ã€Œæ™‚é–“åˆ‡ã‚Œã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’éè¡¨ç¤º
    document.getElementById("gameOverMessage").style.display = "block";
    risingText.style.display = "none";//  ä¸Šæ˜‡æ–‡å­—ã‚’è¡¨ç¤º
    formattedAnswer.style.display = "none"; // ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ†ã‚­ã‚¹ãƒˆã‚’éè¡¨ç¤º
  //  ã‚¹ã‚³ã‚¢ã‚’è¡¨ç¤º
    score = score*(maxLives - timeOutCount);
    updateHighScore(); //  æœ€é«˜å¾—ç‚¹ã‚’æ›´æ–°
    updateHighScoreDisplay(); //  æœ€é«˜å¾—ç‚¹ã‚’è¡¨ç¤º
    finalScore.innerHTML = `ã‚ãªãŸã®ã‚¹ã‚³ã‚¢: ${score}<br>High Score: ${highScore}`; // æœ€é«˜å¾—ç‚¹ã‚‚è¡¨ç¤º
    finalScore.style.display = "block";
  // ã‚¯ã‚¤ã‚ºè¦ç´ ã‚’éè¡¨ç¤º
    document.getElementById("fallingText").style.display = "none";
    document.getElementById("risingText").style.display = "none";
    document.getElementById("inputContainer").style.display = "none";
    document.getElementById("nextButton").style.display = "none";
    document.getElementById("restartButton").style.display = "block";
  // ã‚¿ã‚¤ãƒãƒ¼ã‚’å®Œå…¨ã«åœæ­¢
    clearInterval(timer);
}

//  ã‚«ã‚¹ã‚¿ãƒ ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›æ™‚ã«ä¸Šæ˜‡æ–‡å­—ã‚’æ›´æ–°    
    inputTextInput.addEventListener('input', updateRisingText);

//  ç™ºå°„ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã«ã‚«ã‚¹ã‚¿ãƒ ãƒ†ã‚­ã‚¹ãƒˆç™ºå°„    
    fireButton.addEventListener('click', fireinputText);

//  æ¬¡ã¸ã®ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ 
    nextButton.addEventListener('click', () => {
             
        timeLeft = 20; // åˆ¶é™æ™‚é–“ãƒªã‚»ãƒƒãƒˆ
        inputTextInput.focus();
        //  ç¾åœ¨ã®å•é¡Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ›´æ–°
        currentQuestionIndex++;
        const totalFallSteps = 200;//è½ä¸‹ã‚¹ãƒ†ãƒƒãƒ—æ•°
        const fallDuration = 20000;//è½ä¸‹æ™‚é–“
        if (currentQuestionIndex < quizData.length) {
          loadQuestion(); //æ¬¡ã®å•é¡Œã‚’ãƒ­ãƒ¼ãƒ‰
        } else {
        endGame()
        }
    });


</script>
</body>
</html>
